function waitFor(e,t){let s=setInterval((()=>{let n=document.querySelector(e);n&&(clearInterval(s),t(n))}),500)}const pmDownloaded=new Event("pm-downloaded"),pmComplete=new Event("pm-complete");function injectModal(e){e.insertAdjacentHTML("beforeBegin",'<div id="modal-button"> <svg aria-hidden="true" focusable="false" width="17" height="17" viewBox="0 0 17 19"><path d="M12.6,19.2c-4.1-2.2-7.7-5.2-11.1-8.3,0,0-1.5-1.4-1.5-1.4C3.1,6.2,6.3,3,9.7,0c2.6,2.8,5.2,5.9,7.4,9.1-2,1.5-4,2.9-6.3,4,1-1.9,2.2-3.6,3.4-5.3v1.9c-2.2-1.6-4.3-3.5-6.3-5.3,0,0,3,0,3,0-2.1,2.2-4.3,4.3-6.5,6.4v-3c3.1,3.5,6,7.1,8.1,11.3h0Z"></path></svg></div>');let t=document.createElement("dialog");t.id="gv_pusherman",t.innerHTML='<div class="gv_menu"><h1 class="gv_title">GV Publish</h1><div id="exit" class="gv_exit"><div></div><div></div></div></div><div id="page-1" class="gv_page show-state"><p class="gv_subtitle login_subtitle">Login to GV Publish</p><div class="gv_container"><label for="username" class="gv_label">GV Publish Username</label><div class="gv_text-row"><input type="text" id="username" class="gv_text" placeholder="Username" autocomplete="nope"></div><label for="password" class="gv_label">GV Publish Password</label><div class="gv_text-row"><input type="password" id="password" class="gv_text" placeholder="Password" autocomplete="nope"></div><div><button type="button" id="login" class="gv_button">Login</button></div></div></div><div id="page-2" class="gv_page show-state"><p class="gv_subtitle">Your site will be published to <a href="#" rel="noopener" id="site" class="gv_link"><span>#</span><svg width="11" height="11"><path fill="currentColor" d="M5 1v1h3.293L4.646 5.646l.707.707L9 2.707V6h1V1H5zm2 8H2V4h2V3H2c-.55 0-1 .45-1 1v5c0 .55.45 1 1 1h5c.55 0 1-.45 1-1V7H7v2z"></path></svg></a></p><div class="gv_container"><div class="gv_button-row"><button type="button" id="cancel" class="gv_button">Cancel</button> <button type="button" id="publish" class="gv_button">Publish to green servers!</button></div></div><div id="settings" class="gv_settings"><svg aria-hidden="true" focusable="false" width="16" height="16" viewBox="0 0 16 16" class="bem-Svg" style="display: block;"><path d="M6 12l.01-3V7L6 4l4 4-4 4z" fill="currentColor"></path></svg> Advanced options</div><form id="form" class="gv_form gv_container open-state" autocomplete="off"><div class="gv_text-row"><label for="domain" class="gv_label is-domain">Release Domain</label> <input type="text" class="gv_text" id="domain" placeholder="i.e. greenvision.media" autocomplete="nope"><label for="site-code" class="gv_label is-site-code">Site Code</label> <input type="text" id="site-code" class="gv_text" placeholder="i.e. gv" autocomplete="nope"></div><label for="staging" class="gv_label">Publish Destination</label><div class="gv_button-row"><input type="button" id="staging" class="gv_button pressed-state on" value="Staging" autocomplete="nope"><input type="button" id="release" class="gv_button pressed-state" value="Release" autocomplete="nope"></div><button type="button" id="save" class="gv_button show-state on">Save</button> <button type="button" id="restart" class="gv_button show-state">Configured</button></form></div><div id="page-3" class="gv_page show-state on"><p id="drop-text" class="gv_subtitle login_subtitle">Downloading your files...</p><div class="gv_container"><div id="drop-area" class="gv_drop-area drag-state"><svg id="file" class="show-state" aria-hidden="true" focusable="false" viewBox="0 0 20 20" width="40" height="40"><path fill-rule="evenodd" clip-rule="evenodd" d="M5 3a1 1 0 00-1 1v12a1 1 0 001 1h10a1 1 0 001-1V8l-5-5H5zm5 1H9v6h6V9l-5-5z" fill="currentColor"></path></svg> <svg id="loading" class="show-state on" viewBox="0 0 30 30" width="32" height="32" stroke="#ebebeb" fill="none" fill-rule="evenodd" stroke-width="3"><g transform="translate(2 2)"><g transform="rotate(0)"><circle stroke-opacity=".3" cx="13" cy="13" r="13"></circle><path d="M 13 0 A 13 13 0 0 0 0 13"></path><animateTransform attributeName="transform" begin="0s" dur="1s" type="rotate" from="0 13 13" to="360 13 13" repeatCount="indefinite"></animateTransform></g></g></svg> <svg id="complete" class="show-state" aria-hidden="true" focusable="false" viewBox="0 0 30 30" width="32" height="32"><circle fill="#b3bc7e" cx="14.5" cy="14.5" r="14.5"/><path fill="#4e6a57" d="M21.43,9.18c-1.93,4.63-5.25,8.52-8.68,12.1,0,0-1.32-1.26-1.32-1.26-1.27-1.21-2.38-2.64-3.18-4.24-.27-.56-.52-1.14-.69-1.82,.69,.11,1.29,.31,1.87,.54,1.66,.66,3.17,1.65,4.49,2.82,0,0-2.6,.11-2.6,.11,2.93-3.2,6.21-6.23,10.1-8.24h0Z"/></svg></div></div></div>',document.body.appendChild(t);let s=document.getElementById("modal-button"),n=document.getElementById("exit"),o={p1:document.getElementById("page-1"),p2:document.getElementById("page-2"),p3:document.getElementById("page-3")};login=document.getElementById("login"),cancel=document.getElementById("cancel"),publish=document.getElementById("publish"),settings=document.getElementById("settings"),form=document.getElementById("form"),save=document.getElementById("save"),restart=document.getElementById("restart"),site=document.getElementById("site"),inputs={domain:document.getElementById("domain"),siteCode:document.getElementById("site-code"),release:document.getElementById("release"),password:document.getElementById("password"),staging:document.getElementById("staging")},dropArea=document.getElementById("drop-area"),dropText=document.getElementById("drop-text"),icons={file:document.getElementById("file"),loading:document.getElementById("loading"),complete:document.getElementById("complete")};let i=chrome.storage.sync.get(["PROJECT","DOMAIN","SITECODE","PASSWORD","STAGING"]);resetUI(inputs,o,icons,settings,form,i),setSiteURL(site,i),s.addEventListener("click",(e=>{e.preventDefault,t.showModal()})),n.addEventListener("click",(e=>{e.preventDefault,t.close(),resetUI(inputs,o,icons,settings,form,i)})),login.addEventListener("click",(e=>{o.p1.classList.toggle("on"),o.p2.classList.toggle("on")})),cancel.addEventListener("click",(e=>{e.preventDefault,t.close(),resetUI(inputs,o,icons,settings,form,i)})),settings.addEventListener("click",(e=>{e.preventDefault,settings.classList.toggle("on"),form.classList.toggle("on")})),inputs.staging.addEventListener("click",(e=>{e.preventDefault,inputs.release.classList.toggle("on"),inputs.staging.classList.toggle("on")})),inputs.release.addEventListener("click",(e=>{e.preventDefault,inputs.release.classList.toggle("on"),inputs.staging.classList.toggle("on")})),save.addEventListener("click",(e=>{e.preventDefault,Object.values(inputs).forEach((e=>{e.disabled=!0})),save.classList.toggle("on"),restart.classList.toggle("on"),i=handleConfig(inputs,i),setSiteURL(site,i)})),restart.addEventListener("mouseenter",(e=>{e.preventDefault,restart.innerHTML="Restart"})),restart.addEventListener("mouseleave",(e=>{e.preventDefault,restart.innerHTML="Configured"})),restart.addEventListener("click",(e=>{e.preventDefault,Object.values(inputs).forEach((e=>{e.disabled=!1})),save.classList.toggle("on"),restart.classList.toggle("on")})),publish.addEventListener("click",(t=>{downloadHandler(e),o.p2.classList.toggle("on"),o.p3.classList.toggle("on")})),dropArea.addEventListener("dragenter",(e=>{e.preventDefault,dropArea.classList.add("on")})),dropArea.addEventListener("dragover",(e=>{e.preventDefault,dropArea.classList.add("on")})),dropArea.addEventListener("dragleave",(e=>{e.preventDefault,dropArea.classList.remove("on")})),dropArea.addEventListener("drop",(e=>{e.preventDefault,icons.file.classList.remove("on"),icons.loading.classList.add("on"),dropArea.classList.remove("on"),dropText.innerHTML="Publishing your files...",sendData(e.dataTransfer)})),document.addEventListener("pm-downloaded",(()=>{icons.loading.classList.toggle("on"),icons.file.classList.add("on"),dropText.innerHTML="Drag your .zip file here:"})),document.addEventListener("pm-complete",(()=>{icons.loading.classList.toggle("on"),icons.complete.classList.toggle("on"),dropText.innerHTML="Site published successfully!",setTimeout((()=>{t.close(),resetUI(inputs,o,icons,settings,form,i),dropText.innerHTML="Downloading your files..."}),1500)}))}function resetUI(e,t,s,n,o,i){t.p1.classList.add("on"),t.p2.classList.remove("on"),t.p3.classList.remove("on"),s.file.classList.remove("on"),s.loading.classList.add("on"),s.complete.classList.remove("on"),n.classList.remove("on"),o.classList.remove("on")}function handleConfig(e,t){let s=!0;return s=!!e.staging.classList.contains("on"),t={PROJECT:window.location.pathname.split("/")[2],DOMAIN:e.domain.value,SITECODE:e.siteCode.value,PASSWORD:e.password.value,STAGING:s},chrome.storage.sync.set(t),t}function setSiteURL(e,t){t.STAGING?(e.setAttribute("href",`https://${t.SITECODE}.greenvisionmedia.net`),e.querySelector("span").innerHTML=t.SITECODE+".greenvisionmedia.net"):(e.setAttribute("href",`https://${t.DOMAIN}`),e.querySelector("span").innerHTML=t.DOMAIN)}function sendData(e){let t=new FormData;t.append("file",e),fetch("https://pusherman.free.beeceptor.com",{method:"POST",body:t}).then((()=>{document.dispatchEvent(pmComplete)})).catch((e=>{console.log(e)}))}function writeYAML(e){return`name: Deploy\n  on:\n    push:\n    workflow_dispatch:\n  jobs:\n    deploy:\n      uses: greenvisionmedia/actions/.github/workflows/gv-deploy.yml@main\n      with:\n        staging: ${e.staging}\n        domain: ${e.domain}\n        subdomain: ${e.siteCode}.greenvisionmedia.net\n      secrets:\n        test: \${{secrets.TEST_PASSWORD}} \n        ftp: \${{secrets.FTP_PASSWORD}}`}function downloadHandler(e){e.click();let t='div[style="display: flex; justify-content: space-between; flex: 0 1 auto;"]';waitFor(t+" button:nth-child(4)",(e=>{e.click(),waitFor(t+' a[href^="blob:"]',(e=>{e.click(),setTimeout((()=>{document.querySelector(t+" button:nth-child(3)").click(),document.dispatchEvent(pmDownloaded)}),10)}))}))}waitFor(".bem-TopBar_Body_ExportButton",injectModal);