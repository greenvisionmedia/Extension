const TYPE_HTML="text/html",TYPE_PLAIN="text/plain",TYPE_XML="text/xml";function waitFor(e,t,n){let r=setInterval((()=>{let n=document.querySelector(e);n&&(clearInterval(r),t(n))}),n)}waitFor(".w-codemirror",getEmbedInput,1e3);const svgRegex=/^<\?xml version="1.0" encoding="UTF-8"\?>\s*/;function getEmbedInput(e){e.addEventListener("click",pasteSVG),e.addEventListener("copy",pasteSVG),e.addEventListener("focus",pasteSVG)}async function SVGtoClipboard(e){const t=(new XMLSerializer).serializeToString(e);await navigator.clipboard.writeText(t)}async function pasteSVG(){let e=await navigator.clipboard.readText();if(svgRegex.test(e)){let t=(new DOMParser).parseFromString(e,TYPE_XML),n=t.querySelector("svg");n.removeAttribute("xlmns"),n.removeAttribute("data-name"),n.removeAttribute("width"),n.removeAttribute("height");let r=t.querySelector("defs");r&&r.remove(),await SVGtoClipboard(t)}}window.addEventListener("focus",pasteSVG),waitFor(".bem-RichTextInput",getRichTextInput,1e3);const markdownRegex=/^@markdown\s*/,markdownStringNoNewLine="@markdown";function getRichTextInput(e){const t=e.parentElement.querySelector("div.bem-Field_Head");if(!t)return;const n=t.querySelector("div.bem-View");if(!n)return;n.classList.add("mp-container"),e.addEventListener("click",pasteMarkdown),e.addEventListener("copy",pasteMarkdown),e.addEventListener("focus",pasteMarkdown);const r=document.createElement("div");r.innerHTML='When pasting Markdown, make sure the contents start with <span class="mp-chip">@markdown</span> on its own line. <a class="mp-link" href="https://greenvision.media/docs/build-process/" target="_blank">Learn More</a>',r.classList.add("mp-info"),n.appendChild(r)}async function formatMarkdownToHTML(e){return markdown(e.replace(/\u00A0\//g," ").replace(markdownRegex,""))}async function HTMLtoClipboard(e){const t=new Blob([e],{type:TYPE_HTML}),n=[new ClipboardItem({[TYPE_HTML]:t})];await navigator.clipboard.write(n)}async function pasteMarkdown(){const e=await navigator.clipboard.read();for(const t of e)for(const e of t.types){const n=await t.getType(e),r=await n.text();if(e===TYPE_PLAIN&&markdownRegex.test(r)){const e=await formatMarkdownToHTML(r);await HTMLtoClipboard(e)}else if(e===TYPE_HTML){const e=(new DOMParser).parseFromString(r,TYPE_HTML).querySelector("body");if(!e.textContent.startsWith("@markdown"))return;let t=[];if(e.children.length>=2)t=Array.from(e.children);else{if(!(1===e.children.length&&"div"===e.children[0].tagName.toLowerCase()&&e.children[0].children.length>=2))return;t=Array.from(e.children[0].children)}t=t.filter((e=>"meta"!==e.tagName.toLowerCase())).slice(1);const n=[];for(let e=0;e<t.length;e++){const r=t[e];let a;const o=r.tagName.toLowerCase();a="p"===o||"div"===o?await formatMarkdownToHTML(r.textContent):r.outerHTML,n.push(a)}if(0===n.length)return;await HTMLtoClipboard(n.join("\n"))}}}function markdown(e){var t=/\\([\\\|`*_{}\[\]()#+\-~])/g,n=/\n *&gt; *([^]*?)(?=(\n|$){2})/g,r=/\n( *)(?:[*\-+]|((\d+)|([a-z])|[A-Z])[.)]) +([^]*?)(?=(\n|$){2})/g,a=/(^|[^A-Za-z\d\\])(([*_])|(~)|(\^)|(--)|(\+\+)|`)(\2?)([^<]*?)\2\8(?!\2)(?=\W|_|$)/g,o=/^.*\n( *\|( *\:?-+\:?-+\:? *\|)* *\n|)/,i=/.*\n/g,c=/\||(.*?[^\\])\|/g;function s(t,n){e=e.replace(t,n)}function l(e,t){return"<"+e+">"+t+"</"+e+">"}function d(e){return e.replace(a,(function(e,t,n,r,a,o,i,c,s,u){return t+l(r?s?"strong":"em":a?s?"s":"sub":o?"sup":i?"small":c?"big":"code",d(u))}))}function u(e){return e.replace(t,"$1")}var p=[],g=0;return e="\n"+e+"\n",s(/</g,"&lt;"),s(/>/g,"&gt;"),s(/\t|\r|\uf8ff/g,"  "),e=function e(t){return t.replace(n,(function(t,n){return l("blockquote",e(d(n.replace(/^ *&gt; */gm,""))))}))}(e),s(/^([*\-=_] *){3,}$/gm,"<hr/>"),e=function e(t){return t.replace(r,(function(t,n,r,a,o,i){var c=l("li",d(i.split(RegExp("\n ?"+n+"(?:(?:\\d+|[a-zA-Z])[.)]|[*\\-+]) +","g")).map(e).join("</li><li>")));return"\n"+(r?'<ol start="'+(a?r+'">':parseInt(r,36)-9+'" style="list-style-type:'+(o?"low":"upp")+'er-alpha">')+c+"</ol>":l("ul",c))}))}(e),s(/<\/(ol|ul)>\n\n<\1>/g,""),s(/\n((```|~~~).*\n?([^]*?)\n?\2|((    .*?\n)+))/g,(function(e,t,n,r,a){return p[--g]=l("pre",l("code",r||a.replace(/^    /gm,""))),g+""})),s(/((!?)\[(.*?)\]\((.*?)( ".*")?\)|\\([\\`*_{}\[\]()#+\-.!~]))/g,(function(e,t,n,r,a,o,i){return p[--g]=a?n?'<img src="'+a+'" alt="'+r+'"/>':'<a href="'+a+'">'+u(d(r))+"</a>":i,g+""})),s(/\n(( *\|.*?\| *\n)+)/g,(function(e,t){var n=t.match(o)[1];return"\n"+l("table",t.replace(i,(function(e,t){return e==n?"":l("tr",e.replace(c,(function(e,r,a){return a?l(n&&!t?"th":"td",u(d(r||""))):""})))})))})),s(/(?=^|>|\n)([>\s]*?)(#{1,6}) (.*?)( #*)? *(?=\n|$)/g,(function(e,t,n,r){return t+l("h"+n.length,u(d(r)))})),s(/(?=^|>|\n)\s*\n+([^<]+?)\n+\s*(?=\n|<|$)/g,(function(e,t){return l("p",u(d(t)))})),s(/-\d+\uf8ff/g,(function(e){return p[parseInt(e)]})),e.trim()}